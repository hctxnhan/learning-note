Có 3 loại noti: mobile push noti, SMS, Email.
> Yêu cầu hệ thống (từ trong sách):
> - Các loại noti: Push, SMS, email.
> - Real-time? soft real-time system, có nghĩa là muốn user nhận được thông báo càng sớm càng tốt. Nếu hệ thống đang chịu tải cao thì một chút delay là chấp nhận được.
> - Supported device: Mobile, desktop.
> - Trigger? Có thể được trigger từ phía client và cũng có thể được đặt lịch phía server side.
> - User có quyền tắt noti.
> - Bao nhiêu noti mỗi ngày: 10 triệu mobile, 1 triệu SMS, 5 triệu email.

# High level design
High level design cho các loại noti: iOS và Android Push noti, SMS và Email.
## Different types of notifications
### iOS
![[Pasted image 20230503230446.png]]
Có 3 components để gửi iOS push noti:
- Provider: build và send noti request tới cho Apple Push Notification Service (APNS). Để tạo 1 push noti, provider phải cung cấp những data sau:
	- Device token: Unique id để gửi push noti.
	- Payload: JSON chứa payload của noti. VD: 
	![[Pasted image 20230503230632.png]]
- APNS: Là một remote service cung cấp bởi Apple để propagate push noti tới iOS device.
- iOS device: Là end client nhận noti.
### Android
Tương tự nhưng thay vì dùng APNS thì thường dùng Firebase Cloud Messaging (FCM).
![[Pasted image 20230503230838.png]]
### SMS
![[Pasted image 20230503230909.png]]
### Email
![[Pasted image 20230503230922.png]]
Dù company có thể setup email server cho mình nhưng thường họ dùng các service có sẵn.
Sau khi add hết các service này vào:
![[Pasted image 20230503231012.png]]
## Contact info gathering flow
Trước khi gửi được noti thì ta cần phải có thông tin trước như: device token, phone number, email address.
Như ta thấy, khi người dùng cài đặt hoặc sign up thì API servers sẽ collect thông tin của user và lưu vào db.
![[Pasted image 20230503231250.png]]
![[Pasted image 20230503231342.png]]
## Notification sending/receiving flow
### High level design
![[Pasted image 20230503231426.png]]
- **Service từ 1..N** có thể là micro-service, cron job, distributed system trigger event gửi noti.
- **Noti system:** cung cấp API cho service 1..N và build noti payload để gửi cho third party service.
- **Third party services**: là những service có nhiệm vụ gửi noti cho user. Khi integrate các services này ta phải đảm bảo tính mở rộng của nó.
## High level design (improve)
- Chuyển database và cache ra khỏi notification server.
- Thêm nhiều notification server.
- Thêm message queue để decouple system component.
